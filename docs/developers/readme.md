# 开发信息文档

## 分支说明

```
main: 稳定版
4.X-dev: WebGAL 4.x 开发版
其他分支: 旧版本的留档
```

## 开发计划

### 下一代 Galgame 引擎： WebGAL 4.X 开发计划

1、将 UI 状态、演出状态与舞台状态彻底分离，进而使得状态管理更加清晰，各模块各司其职。

2、在开发之初就全面考虑移动端适配问题，绝不把适配问题拖入后期，力求达到与桌面端一致的使用体验。

3、优化项目结构，明确各模块职责，完善注释，力求让大一刚上完 C 语言的学生也能看懂。

4、添加更多设置选项，满足不同用户的需求。

5、添加快速存/读档功能。

6、剧本支持“子过程”，实现类似于函数的调用。

```
状态管理相关：
分为 ：
“舞台状态”：可以被存读档、backlog 记录的“演出结束后终态”。
“GUI状态” ：记录当前的界面状态，引擎初始化时重置。
“用户数据状态集”：包括用户存档数据、设置数据等，在每次触发相关操作时，由 StorageController 与本地数据（拟使用LocalForage）同步。
运行时变量相关：
“GamePlay 变量集”：用于储存当前游戏的运行时变量，包括演出状态等。
“Backlog 变量”：用于在指定时机触发对 backlog 的读写。
“Scene 变量”：用于存储当前场景的数据，同时可以使用一个“场景栈”来实现子场景的调用（在调用子场景时记录当前场景的位置，在子场景调用完毕后恢复这个位置，继续解析）。
控制器相关：
UI控制：相应用户操作，改变GUI状态。
演出控制：控制所有演出，并维护一个“当前正在执行的演出数”，来记录当前是否正在发生演出，在发生几个演出。如果被打算，重置并结束所有演出，并删除所有计时器（为了防止延迟触发）。
舞台控制：改变舞台状态。
界面相关：
所有界面的状态由GUI状态描述
所有与用户数据有关的状态由用户数据状态集维护，在触发这些界面的挂载时，同步数据。
其他：
待补充。
```

### 有关脚本格式的说明

语法：

`command:content -parameter1 -parameter2 ......;`

例如：

`changeP:testFigure04.png -left -next;`
