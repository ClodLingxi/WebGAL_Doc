# WebGAL ゲーム開発ガイド

## WebGAL でゲーム開発を行う方法

::: warning 警告
WebGAL ゲームを作成するために使用する方法にかかわらず、このページ全体をじっくりと読むことをお勧めします。それほど時間はかかりませんが、不適切な操作から生じる可能性のある問題を回避するのに役立ちます。

WebGAL のドキュメンテーションには、ほとんどの疑問に対する回答が見つかることをご存知でしょうか？もしバグに遭遇したと確信している場合は、[issues](https://github.com/MakinoharaShoko/WebGAL/issues) でバグを報告するか、[contact@openwebgal.com](mailto:contact@openwebgal.com) に連絡してください。また、WebGAL コミュニティに参加する方法は、サイトの右上隅にある`その他`セクションで見つけることができます。
:::

### その1 : WebGAL エディターを使用(推奨)

**WebGAL エディターは、WebGAL でゲームを作成し、開発し、公開するための最良の方法です。**

WebGAL エディターをダウンロードした後、zipを解凍し、WebGAL_Terre.exe を起動します。WebGAL_Terre はブラウザを自動的に開きます。開かない場合は、ブラウザから [http://localhost:3001/](http://localhost:3001/)にアクセスしてください。

::: danger 警告
エディターを開くには、最新のブラウザ (Chrome / Firefox / Edge) を使用してください。その他のブラウザはサポート対象外です。
:::

::: tip ヒント
このページの内容は Windows 7 にサポートしていません。Windows 7 をご利用の方は、**[Windows 7 でビジュアルエディターを使用してゲーム開発を行う方法](./win7)** を参照してください。

WebGAL エディターは現在 Windows 10+ システムでのみテストされています。Mac OS および Linux のサポートは、今後順次追加していく予定です。
:::

WebGAL エディターのダウンロードリンク:

[GitHub](https://github.com/MakinoharaShoko/WebGAL_Terre/releases)

### その2 : スクリプトを作成してローカルで開発し、リアルタイムでデバッグ

まず、静的なウェブページとデバッグ環境が組み込まれた WebGAL 配布をダウンロードしてください。

WebGAL エンジンとデバッグ環境（ビジュアルエディターは含まれていません）をダウンロードします。

[GitHub](https://github.com/MakinoharaShoko/WebGAL/releases/)

ダウンロードして解凍した後、対応するバージョンの WebGAL-server を直接実行して、ビジュアルノベルゲームをデバッグできます。もしアンチウイルスソフトウェアやファイアウォールによる遮断が発生した場合は、実行を許可してください。

開発には VS Code を使用することをお勧めし、シンタックスハイライトを有効にするためにプラグインを利用してください：

[シンタックスハイライトプラグインのストアリンク](https://marketplace.visualstudio.com/items?itemName=c6h5-no2.webgal-script-basics)

[シンタックスハイライトプラグインのソースコードリポジトリ](https://github.com/C6H5-NO2/webgal-script-basics)

### その3 : ソースコードからデバッグ（高いカスタマイズ性を望むフロントエンド開発者向け）

```
git clone https://github.com/MakinoharaShoko/WebGAL.git
```

yarn をインストールします。次に、yarn を使用して依存関係をインストールします

```
npm install yarn -g
yarn
```

WebGAL パッケージに移動します

```
cd packages/webgal
```

WebGAL は、vite をパッケージ化およびデバッグツールとして使用します。webgal パッケージを入力した後、次のコマンドを実行してローカルサーバーを起動します

```
yarn dev
```

パッケージは、

```
yarn build 
```

## ビジュアルノベルゲームのデプロイまたは公開方法

まず、インターネットにデプロイ可能なエンジンは、**WebGAL リリース バージョン または WebGAL エディタから Web ページとしてエクスポートされたもの**であることに注意してください。ソースコードではありません。

**WebGAL エディタを使用する場合、右上隅にある`ゲームを出力`をクリックします。一般的に、エクスポートが完了すると自動的にファイルエクスプローラーが開きます。自動的に開かれない場合は、WebGAL エディタのディレクトリの中にある `Exported_Games` フォルダーの中に見つけることができます。**

### ウェブページ

*　**WebGAL エディタ**を使用する場合：*

WebGAL エディタの右上隅で`ゲームを出力`をクリックし、`ウェブとしてエクスポート`を選択します。Web ページのデプロイ方法は通常のウェブサイトのデプロイ方法と同じです。クラウドサーバー（Tencent Cloud、Alibaba Cloud）を購入するか、GitHub Pages を使用することができます。

*　**WebGAL リリースバージョン**を使用する場合：*

`/WebGAL`フォルダーのファイル（フォルダーではなく、`/WebGAL`フォルダーの中のファイル）を、デプロイするクラウドサーバーの指定したディレクトリにコピーするか、GitHub Pages にデプロイできます。

*　**ソースコード**を使用して開発する場合：*

ソースコードを使用してデバッグする場合、`yarn build` を実行して静的ウェブページ（`/dist`フォルダーの中）を作成し、それをデプロイするクラウドサーバーの指定したディレクトリにコピーするか、GitHub Pages にデプロイできます。

### Windows / macOS / Linux

WebGAL エディタの右上隅で`ゲームを出力`をクリックし、`実行可能ファイルとしてエクスポート`を選択します。実行可能ファイルが WebGAL エディタを起動するシステム(Windows / macOS / Linux)で直接実行できます。

### Android

ゲームを Android プラットフォームにパッケージ化したい方は[こちら](./android)。

## ゲームスクリプトのチュートリアル

これで、WebGAL エディタを起動するか、デバッグサーバーを起動したはずです。次に、スクリプトの書き方について紹介します。

解凍されたフォルダーの中に、WebGAL フォルダーがあるはずです。WebGAL フォルダーの中には、ゲームフォルダーがあります。このフォルダーは、あなたのゲームのリソースを保存するべきところです。**（ビジュアルエディタを使用する場合は、左のツールバーで対応するリソースフォルダーを直接開くことができます）**

ゲームのすべてのスクリプト、画像、立ち絵などは、ゲームフォルダーの中に配置する必要があります。ディレクトリに対応するリソースの説明は次のとおりです：

| フォルダー  | 保存されるリソース :-------------------------------------- |
| ---------- | -------------------------------------------------------- |
| animation  | アニメーション記述ファイル                                  |
| background | 背景画像、タイトルページの背景                              |
| figure     | 立ち絵                                                    |
| scene      | スクリプト                                                |
| bgm        | BGM                                                      |
| vocal      | ボイス、SEなど                                            |
| video      | ビデオ、動画　　　　　                                      |
| tex        | 特殊効果用　　　　　　　　　　　　　　                       |

## ゲーム情報のカスタマイズ

`/game`フォルダーの下には、`config.txt`というファイルがあります。ここにゲームに関する情報を入力できます（ビジュアルエディタを使用して直接編集することもできます）：

```
Game_name:WebGAL;//ゲーム名
Game_key:0f33fdGr;//識別コードの文字列。できるだけ6-10文字の長さの文字列をランダムに入力してください。他のゲームと重複しないようにする必要があります。そうしないとバグが発生する可能性があります。
Title_img:Title2.png;//タイトル画像の名前。画像は /background フォルダーに保存してください。
Title_bgm:夏影.mp3;//タイトルの BGM。音楽ファイルは /bgm フォルダーに保存してください。
```

## コメント

WebGAL のスクリプトでは、各行のセミコロンの前の内容のみが解析されます。そのため、セミコロン以降はコメントとみなされます。

```
WebGAL:こんにちは！; // セミコロン以降はコメントとみなされます
;行の先頭にセミコロンを入力することで、1行のコメントを書くこともできます。
```

## `-next` パラメータ

`-next` パラメータは、任意のステートメントの後に追加することができます。これにより、そのステートメントが実行された後、直ちに次のステートメントを実行することができます。特に、複数の操作を同時に実行する必要がある場合に便利です。

例:

```
changeBg:testBG03.jpg -next; // このステートメントが実行された後、直ちに次のステートメントを実行します
```

## `none` キーワード

`none` キーワードを使用することで、立ち絵、BGM、背景などの**リソース**を無効にすることができます。

## スクリプトの構文

まず、ゲームは**最初のスクリプト**である`start.txt`から実行を開始します。シーンジャンプや選択肢の設定方法については[こちら](#シーンジャンプと選択肢)。

**スクリプトを記述方法は非常に簡単であり、自然言語とほとんど変わりません。**

### キャラクターの会話

まず、メモ帳、VS Code、Sublime などのテキストエディタを使用して、ゲームリソースディレクトリの `scene` フォルダーの中の `start.txt` を開き、最初の会話を書き始めることができます。

キャラクターの会話を書く方法は非常に簡単です。次のように入力するだけです。

**各行のコロンとセミコロンは半角文字である必要があることに注意してください！**

```
キャラクター:セリフ; 
```

例:

```
雪ノ下 雪乃: お茶、どうぞ。;
由比ヶ浜 結衣: あ、ありがとうございます。;
比企谷 小町: 雪乃さん、ありがとうございます！;
一色 いろは: 先輩、ありがとうございます！;
```

各行の後にはセミコロンを使用して終了してください。（セミコロンを書かなくても機能する場合もありますが、バグを防ぐためにセミコロンを追加することをお勧めです）。

### 連続セリフ

連続した複数行のセリフでキャラクターが変更されない場合は、キャラクター名を省略できます。 キャラクターを変更する必要がある場合は、キャラクター名を再度使用します。

```
雪ノ下雪乃: 早かったわね;
結構待ったの？;//この時点では、セリフのキャラクター名は「雪ノ下雪乃」のままです。
比企谷八幡:今着いたところ;
```

#### ナレーター

キャラクターの名前なしでナレーターを作成する場合は、コロンの前に空白のままにします(コロンは省略しないでください)。

```
:これはナレーターです。
```

### セリフを表示しながら音声を再生する

ご存知のように、ビジュアルノベルゲームの最も魅力的な部分は、優れた吹き替えです。このバージョンでは、セリフに音声を導入することができます。音声ファイルを `vocal` フォルダーに入れ、パラメータとしてセリフに追加します。構文の例は次のとおりです。

```
比企谷八幡:今着いたところ -V3.ogg;
```

連続セリフの場合は、同じ方法で音声を導入します。

```
雪之下雪乃:早かったわね -V1.ogg;
結構待ったの？ -V2.ogg;
```

### モノローグ

多くのゲームでは、テーマを紹介したり、キャラクターの心理活動を示したりするために、モノローグを使用します。`intro` コマンドを利用して、モノローグを使用することができます。

```
intro:思い出には適切な台本は必要ありません。| とにかく一度言ってしまうと、| それはすべて冗談になりました。;
```

モノローグの分割は、区切り文字 `|` で区切られており、各 | は改行を表します。実際のプレゼンテーションでは、上記のモノローグは次のようになります。

```
思い出には適切な台本は必要ありません。
とにかく一度言ってしまうと、
それはすべて冗談になりました。
```

### 背景画像と立ち絵の変更

WebGAL が背景画像と立ち絵を読み取れるようにするには、背景画像を `background` フォルダーに配置し、立ち絵を `figure` フォルダーに配置する必要があります。

次に、次の簡単なステートメントを使用して、現在表示されている背景画像と立ち絵を変更します。

```
changeBg:testBG03.jpg;//背景画像を変更する
changeFigure:testFigure02.png;//立ち絵を変更する
changeBg:none;//背景を表示しない
changeFigure:none;//立ち絵を表示しない
```

背景画像または立ち絵を変更した後、次のステートメントを実行するためにマウスをもう一度クリックする必要があります。背景画像と立ち絵を変更した直後に次のステートメントの内容を実行したい場合は、`-next` を使用してください。

```
changeBg:testBG03.jpg -next; //背景画像を変更する
changeFigure:testFigure02.png -next;//立ち絵を変更する
一色:先輩、ありがとうございます！;
```

こうしたら、ゲームは背景画像または立ち絵を変更した直後に、次のステートメントを実行します。

### 立ち絵を異なる位置に配置する

3つの異なる位置に立ち絵を配置することができます。立ち絵を配置するステートメントに、パラメータとして、位置を追加するだけです。

```
changeFigure:testFigure03.png -left;
changeFigure:testFigure04.png;
changeFigure:testFigure05.png -right;
```

上記のは、左、中央、右の3つの位置に3つの異なる立ち絵を配置しています。3つの異なる位置の立ち絵は互いに独立しているため、クリアする必要がある場合は、別々にクリアする必要があります。

```
changeFigure:none -left;
changeFigure:none;
changeFigure:none -right;
```

立ち絵を変更した直後にステートメントを実行したい場合、`-next` を使用してください。

```
changeFigure:testFigure03.png -left -next;
changeFigure:testFigure04.png -next;
changeFigure:testFigure03.png -right -next;
```

### ID 付きの立ち絵

立ち絵をより正確に制御したい場合は、立ち絵に `id` を指定することがお勧めです。

```
changeFigure:testFigure03.png -id=test1; // ID 付きの立ち絵を表示する
changeFigure:none -id=test1; // ID で立ち絵を表示しない
```

注意: ID 付きの立ち絵の位置をリセットしたい場合は、まず表示しないようにしてから再度表示してください。

### ミニアバターを配置する

多くのゲームでは、テキストボックスの左下隅にミニアバターを配置できます。このエンジンで使用される構文は次のとおりです。

```
miniAvatar:minipic_test.png;// minipic_test.png をミニアバターとして表示する
miniAvatar:none;// ミニアバターを表示しない
```

### シーンジャンプと選択肢

ビジュアルノベルゲームでは、シーンジャンプと選択肢が欠かせないです。WebGAL でも、シーンジャンプと選択肢をサポートしています。

スクリプトを複数の `txt` ファイルに分割し、簡単なステートメントを使用して現在実行中のシーンを切り替えることができます。

::: warning 警告
シーンジャンプまたはシーンコールの後、シーンはクリアされません。これは、前のシーンの BGM 、立ち絵、背景画像、およびその他のリソースが次のシーンに継承されることも意味します。

WebGAL エディターを使用する場合は、WebGAL エディターは、1つのシーンのみをプレビューするときに前のシーンの効果が表示されないため、特に注意を払う必要があります。そのため、プレビュー効果と実際のゲーム実行効果は異なる場合があります。シーンジャンプの前にシーンクリーンアップを適切に処理することを検討する必要があります。
:::

`Chapter-1.txt` と `Chapter-2.txt` の 2 つのスクリプトがある場合、`Chapter-1.txt` の実行が終了した後に `Chapter-2.txt` に対応するシーンにジャンプする場合は、次のステートメントを使用します。

#### シーンジャンプ

ステートメント:

```
changeScene:Chapter-2.txt; 
```

例:

```
(Chapter-1.txt) 
......
......
changeScene:Chapter-2.txt;
次に実行するのは、Chapter-2.txt の内容です。
...... 
......
(Chapter-2.txt)
```

このコマンドを実行すると、新しいシーンに切り替えてゲームを続行します。新しいシーンは、次にマウスをクリックした後に実行されます。

#### シーンコール

呼び出したシーンを実行した後、前のシーン(親シーン)に戻る必要がある場合は、`callScene` コマンドを使用してシーンを呼び出す必要があります。

ステートメント:

```
callScene:Chapter-2.txt;
```

例:

```
(Chapter-1.txt)
...... 
......
callScene:Chapter-2.txt;
次に実行するのは、Chapter-2.txt の内容です。
......
......
(Chapter-2.txt) 
......
(Chapter-2.txt の実行が完了しました)  
親シーンに戻り、親シーンの実行を続行します。
......
```

#### 選択肢

スクリプトに選択肢があり、異なるオプションを選択して異なるシーンに入りたい場合は、次のステートメントを使用してください。

ここで、`|` は区切り文字です。

```
choose:彼女に声をかける:Chapter-2.txt|家に帰る:Chapter-3.txt;
```

オプションのテキストを、オプションを選択した後に入りたいスクリプトファイルと 1 対 1 で対応させるだけで、選択肢の機能を実現できます。

### ゲームを終了してタイトルに戻る

スクリプトが終了した後にゲームを終了してタイトルに戻りたい場合は、次のステートメントを使用してください。

```
end;
```

これにより、ゲームはタイトル画面に戻ります。

### BGMの使用

BGM を使用する方法は非常に簡単です。BGM ファイル を /bgm フォルダーに配置し、必要なときに再生するだけです。

```
bgm:夏影.mp3;
```

### 効果音の使用

```
playEffect:xxx.mp3;
```

短い効果音を再生できます。

**効果音のループ**

効果音に ID を指定すると、効果音のループが自動的に有効になります。後で同じ ID を使用して停止します。

```
playEffect:xxx.mp3 -id=xxx; // 効果音のループを有効にする
playEffect:none -id=xxx; // 効果音のループを停止する
```

### 短い動画を再生する

```
playVideo:OP.mp4; // 動画は /game/video フォルダーに配置する必要があります
```

### 鑑賞のためにBGMやCGのアンロック

バージョン4.2以降、WebGAL は BGM と CG の鑑賞機能を追加しました。次のステートメントを実行することで、BGM または CG をタイミングよくアンロックすることができます。

```text
unlockCg:xgmain.jpeg -name=喫茶ステラと死神の蝶 -series=1; // CG をアンロックする
unlockBgm:s_Title.mp3 -name=Smiling-Swinging!!; // BGM をアンロックする
```

その中で、`series` パラメータはオプションであり、CG がどのシリーズに属しているかを表します。同じシリーズの CG は、将来統合されて一緒に表示されます(つまり、同じシリーズの切り替え可能な CG として表示されます)。

### テキストボックスを閉じる

一部の特殊効果を表示するために、テキストボックスを一時的に閉じたい場合は、次のステートメントを使用してください。

```
setTextbox:hide;  
```

`setTextbox` コマンドの内容が `hide` の場合、テキストボックスは閉じられ、ユーザーはそれを開くことができなくなります。テキストボックスを再表示する場合は、このコマンドを再度使用して、`hide` 以外の内容を入力してください。

```
setTextbox:on; // hide 以外の内容を入力してください。
```

### アニメーション効果の使用

#### 背景画像または立ち絵にアニメーションを設定する

Use statement `setAnimation:animation name -target=target object;`

**例:**

```
setAnimation:enter-from-bottom -target=fig-center -next; // 真ん中の立ち絵に下から入るアニメーションを設定し、次のステートメントに進む。
```

#### 事前に作成されたアニメーション

| アニメーション             | ファイル                  | 継続時間 (ミリ秒) |
| :------------------------ | :----------------------- | :--------------- |
| フェードイン               | enter.json               | 300              |
| フェードアウト             | exit.json                | 300              |
| 左右に振る                 | shake.json               | 1000             |
| 下から入る                 | enter-from-bottom.json   | 500              |
| 左から入る                 | enter-from-right.json    | 500              |
| 右から入る                 | enter-from-left.json     | 500              |
| 1回前後に動かす            | move-front-and-back.json | 1000             |

現在、アニメーション化できるオブジェクトは次のとおりです。

| オブジェクト     | 実際のオブジェクト    |
| :--------- | :----------------------- |
| fig-left   | 左の立ち絵                |
| fig-center | 真ん中の立ち絵            |
| fig-right  | 右の立ち絵                |
| bg-main    | 背景                     |
|            | ID 付き立ち絵             |

#### カスタムアニメーション

アニメーションファイルは `/game/animation` にあります。独自のカスタムアニメーションを作成することができます。

アニメーションファイルは JSON を使用して記述します。JSON 構文を知りたい方は [こちら](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON) 。

各アニメーションファイルは、JSON 配列を使用して記述された **アニメーションシーケンス** を表します。サンプルとして、「左から入る」のアニメーションを次に示します。

```
enter-from-left.json
```

```json
[
  {
    "alpha": 0, 
    "scale": {
      "x": 1,
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": -50,
      "y": 0
    },
    "rotation": 0,
    "blur": 5,
    "duration": 0
  },
  {
    "alpha": 1,
    "scale": {
      "x": 1,  
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": 0,
      "y": 0
    },
    "rotation": 0,
    "blur": 0,
    "duration": 500
  } 
]
```

各アトリビュートの意味は次のとおりです。

| アトリビュート | 意味                                               |
| :------------ | :------------------------------------------------- |
| alpha         | 透明度、範囲 0 ～ 1                                 |
| scale         | ズーム                                              |
| pivot         | アンカーポイント                                    |
| position      | 位置オフセット                                      |
| rotation      | 回転角度                                            |
| blur          | ガススぼかし                                        |
| duration      | 継続時間 (ミリ秒 (ms) 単位)                          |

次に、カスタムアニメーションのファイル名(拡張子なし)を `animationTable` に追加する必要があります。

ファイル `animationTable.json` で:

```json
["enter-from-left","enter-from-bottom","enter-from-right"]
```

次に、スクリプトでそれを呼び出すことができます。

```
setAnimation:enter-from-left -target=fig-left -next;
```

#### 一部の属性を省略する

アニメーションで一部のアトリビュートのみを操作する必要がある場合は、ほかのアトリビュートを空のままにして、デフォルトのままにすることができます。

**例:`enter.json`**

```json
[
  {
    "alpha": 0,
    "duration": 0
  },
  {
    "alpha": 1,
    "duration": 300
  }
]
```

#### 変換の使用

継続時間が 0 ミリ秒で、タイムスライスが 1 つだけのアニメーションは変換です。

**例:**

```json
[
  {
    "alpha": 0, 
    "duration": 0
  }
]
```

### 特殊効果の追加

現在、WebGAL の特殊効果システムは PixiJS によって実装されています。

#### Pixiの初期化

`pixiInit`

```
pixiInit; 
```

**注意:**

**1. 特殊効果を追加したい場合は、まずこのコマンドを実行して Pixi を初期化する必要があります。**

**2. 追加した特殊効果をクリアしたい場合も、このコマンドを実行してください。**

#### 特殊効果の追加

`pixiPerform`

```
pixiPerform:rain; // 雨の特殊効果を追加する
```

注意: 特殊効果が追加した後、初期化されていない場合は継続して実行されます。

#### 事前に作成された特殊効果

| Effect | Command           |
| :----- | :---------------- |
| 雨     | pixiPerform:rain; |
| 雪     | pixiPerform:snow; |

#### 重ね合わせた特殊効果

2 つ以上の特殊効果を重ね合わせたい場合は、`pixiInit` コマンドを使用せずに異なる特殊効果を重ね合わせることができます。

```
pixiPerform:rain;
pixiPerform:snow;
```

#### 特殊効果のクリア

`pixiInit` を使用して初期化すると、追加したすべての特殊効果をクリアすることができます。

#### ムービーモード(テスト機能)

ムービーモードのオンとオフを切り替えるには、次のスクリプトを実行します。

```
filmMode:enable; // ムービーモードをオンにする
filmMode:none; // ムービーモードをオフにする
```

## 上級者向けチュートリアル

### ステートメントジャンプと選択肢ジャンプ(同じTXTファイル内)

分岐を作成したいが、新しい TXT ファイルを作成するのが面倒だと感じた場合は、以下を読んでみてください。

**注意:分岐が非常に長い場合は、1 つの TXT の行数が長すぎてはいけないため、この方法を使用することはお勧めしません。**

#### まず、ラベルを作成する

```
......
jumpLabel:label_1; 
; // 次の行は無視される。
...... 
......
......
; // 次に、ラベルを作成する。
label:label_1;
ゲームはここで継続して実行されます。;
......
......
```

つまり、`jumpLabel` は `goto` ステートメントに似ており、スクリプトをシーン内の任意の位置(TXT ファイル)にすぐにジャンプさせることができ、この位置は ラベルを使用して作成する必要があります。

`jumpLabel` を任意のゲートと比較すると、この任意のゲートの終点はラベルが配置されている位置になります。

#### 次に、選択肢を作成する

choose コマンドを使用して選択肢を作成することができます。オプションを選択して、対応するラベルの位置にジャンプします。

```
WebGAL: 選択肢ジャンプをテストしましょう！;
choose:テスト 1:label_1|テスト 2:label_2;
label:label_1;  
ここは分岐 1 です。;
jumpLabel:end;
label:label_2;
ここは分岐 2 です。;
jumpLabel:end; 
label:end;
分岐はここで統一されます;
```

各分岐の最後に、`jumpLabel` を使用して目的の場所にジャンプする必要があることに注意してください。ゲームは直線的に実行されるため、分岐の最後にジャンプしないと、ゲームは次のように継続して実行されます。

```
WebGAL: 選択肢ジャンプをテストしましょう！;
choose:テスト 1:label_1|テスト 2:label_2;  
label:label_1;
ここは分岐 1 です。;
label:label_2;
ここは分岐 2 です。;
分岐はここで統一されます;
```

このスクリプトでは、テスト 2 を選択すると、すべて問題ないように見えます。ただし、テスト 1 を選択すると、テスト 1 の実行後にテスト 2 が実行されることに驚かれることでしょう。これは、ゲームが順番に継続して実行され、分岐の終了後にジャンプするラベルを指定しなかったためです。

### 変数の使用

**注意: ラベルの作成と選択肢ジャンプを理解する前に、混乱を招く可能性があるため、変数を軽々しく使用しないでください。**

変数を設定します。

```
setVar:a=1; // 数値の設定が可能
setVar:a=true // ブール値の設定が可能
setVar:a=Character name // 文字列の設定が可能
```

以前に変数を設定した場合でも、変数を設定するときに再利用できます。

### 条件付き実行

ステートメントの後に `-when=(condition)` を追加することで、条件に基づいて現在のステートメントを実行するかどうかを決定します。

例:

```
setVar:a=1;
changeScene:1.txt -when=a>1; // a > 1 の場合、シーン 1 にジャンプする
changeScene:2.txt -when=a==1; // a が 1 の場合にのみジャンプし、等価演算子は == であることに注意してください
changeScene:3.txt; // a < 1 の場合, 上記のステートメントは実行されないので、当然これは実行される
```

**注意: `=` は代入記号であり、条件付き実行には使用できません。`==` は等値演算子です。**

`-when` パラメータを任意のステートメントに追加して、実行するかどうかを制御できます。`-when` パラメータと `jumpLabel` `callScene` `changeScene` を組み合わせることで、条件付き実行による実行制御を実現できます。

### 会話文に効果を追加する

キャラクターが話している間に表情などを切り替えたい場合があります。
`-notend` と `-concat` パラメータを使用して、会話に任意のステートメントを挿入することができます。

`-concat` は、このセリフは前のセリフの後につながっていることを意味します。

`-notend` は、このセリフはまだ終わっておらず、後で効果やセリフがつながることを意味します。

例: 会話の進行中に立ち絵と表情を切り替える。

```
WebGAL: 会話の進行中に立ち絵の切り替えをテストしてみましょう!今すぐに...... -notend;
changeFigure:k1.png -next;
立ち絵の切り替えが成功しました！表情の切り替えをテストしてみましょう...... -notend -concat; 
changeFigure:k2.png -next;
表情の切り替えも成功しました！ -concat;
```

### カスタム特殊効果の追加

ソースコードをダウンロードし、`/Core/gameScripts/pixiPerformScripts` に移動し、カスタム特殊効果のために `PIXI.Container` を作成します。

```ts
const effectsContainer = RUNTIME_GAMEPLAY.pixiStage!.effectsContainer!; // 現在の Pixi.Container の特殊効果を取得する
const app = RUNTIME_GAMEPLAY.pixiStage!.currentApp!; // Pixi アプリのインターフェースを呼び出すと、画面サイズなどの確認に役立つ場合があります
const container = new PIXI.Container(); // カスタム特殊効果のコンテナを作成する
effectsContainer.addChild(container); // カスタム特殊効果を追加する
```

テクスチャファイルは `/game/tex` フォルダーに配置する必要があります。

次に、ファイルの先頭でカスタム特殊効果の登録メソッドを導入します。

ファイルの末尾で、登録メソッドを使用して、カスタム特殊効果を登録します。最初のパラメータは特殊効果名で、2 番目のパラメータは特殊効果を呼び出すメソッドです。

```typescript
import {registerPerform} from '../pixiPerformManager';

// 特殊効果の定義
function myPerform(parameters) {
  // ...
}

// 登録
registerPerform('myPerform', () => myPerform(parameters)); 
```

最後に、カスタム特殊効果をサポートする WebAPP をコンパイルします

```shell
yarn run build;
```

これで、スクリプトでカスタム特殊効果を呼び出すことができます。

```
pixiPerform:myPerform; // 特殊効果名を指定して特殊効果を呼び出す
```

## その他のチュートリアル

### 他のUI言語をWebGALに追加する

WebGAL に他の言語を追加したい方は[こちら](./add-lang)。

### WebGAL ホームページでゲームを出展しましょう。

[作品を出展しよう](./showcase-your-game) をご覧ください。

## よくある問題と解決策

### ファイルが正しく認識されないのはなぜですか

ファイル名には、特殊記号、スペース、その他の認識しにくいファイル名を使用しないでください。可能な限り純粋な英語のファイル名を使用してください。ファイル拡張子はすべて小文字にする必要があります。

### オーディオファイルが正しく再生されないのはなぜですか

Apple のブラウザでは、ogg ファイルはサポートされていないため、ファイル形式を mp3 に変換する必要があります。

### エクスポートした Web ページを開けないのはなぜですか

ブラウザのセキュリティポリシーにより、ファイルからローカル Web ページを開くことはできません。http サーバーを使用し、Web サイトを展開するのと同じ方法で WebGAL を展開する必要があります。一般的なものは、Nginx、Apache http server、VS Code Live Server プラグイン、Python http server です。

### ビジュアルエディタが Windows 7 で一瞬でなくなったのはなぜですか

node.js のバージョンが Windows 7 でサポートされている最新バージョンよりも高いからです。解決するには[Windows 7 でビジュアルエディタを使用してゲーム開発を行う方法](./win7)を参照してください。

## スターゲイザーの時間変化

[![スターゲイザーの時間変化](https://starchart.cc/MakinoharaShoko/WebGAL.svg)](https://starchart.cc/MakinoharaShoko/WebGAL)
