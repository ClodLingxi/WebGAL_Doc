# 基本语法

首先，程序会从**初始脚本**`start.txt`开始运行，在后续的脚本编写中，会介绍如何跳转章节或设置分支选项。

**编写剧本的方式非常简单，且与自然语言几乎无异。**

## 基本人物对话

首先，使用记事本或 VS Code 、sublime 等文本编辑器，打开游戏资源目录下 scene 文件夹中的 start.txt，然后你就可以开始编写你的第一条对话了。

编写人物对话的方法非常简单，你只需要输入：

**注意，每条对话的冒号、分号应当为英文字符！**

```
人物:对话;
```

示例：

```
雪之下雪乃:请用茶;
由比滨:啊，谢谢;
小町:谢谢雪乃姐！;
一色:谢谢学姐。;
```

在每条对话/剧本后，使用分号作为结束。（如果不写分号有时候也行，但是作者还是建议加上分号以防止 bug）。

### 连续对话

如果你的多条对话没有改变人物名称，你可以使用连续对话，而可以省略人物名称，再在你需要的时候使用：

```
雪之下雪乃:你到得真早;
对不起，等很久了吗？;//此时，对话的人物名称仍然是“雪之下雪乃”。
比企谷八幡:刚到而已;
```

### 旁白

如果你想要创建没有人物名称的旁白对话，请在冒号前留空（但不能省去冒号）：

```
:这是一句旁白;
```

## 在显示对话时同时播放语音

众所周知，视觉小说 最吸引人的地方往往在于其有优秀的配音。在此版本中，你可以为对话引入配音了，将你的配音放入 vocal
文件夹，然后在参数加上语音文件名即可引入，语法示例如下：

```
比企谷八幡:刚到而已 -V3.ogg;
```

在连续对话时，语音的引入方式也是一样的：

```
雪之下雪乃:你到得真早 -V1.ogg;
对不起，等很久了吗？ -V2.ogg;
```

可以为语音设置一个 `-volume` 参数，来调整它的音量：

```
比企谷八幡:刚到而已 -V3.ogg -volume=30; // 当 volume 为数值，且值在 0 ~ 100 范围时可用
```

::: tip 提示
这是可选参数。未使用时，或使用了 0 ~ 100 以外的值时，将使用默认值 100。
:::

## 黑屏文字演示

在许多游戏中，会以黑屏显示一些文字，用来引入主题或表现人物的心理活动。你可以使用 intro 命令来演出独白：

```
intro:回忆不需要适合的剧本，|反正一说出口，|都成了戏言。;
```

独白的分拆以分隔符(|)来分割，也就是说，每一个 | 代表一个换行。在实际演出中，上面的文字会变成：

```
回忆不需要适合的剧本，
反正一说出口，
都成了戏言。
```

## 改变背景/人物立绘

要让 WebGAL 能够读取背景图片和人物立绘，你的背景图片应该被放在 background 文件夹内，而立绘图片则应该放在 figure 文件夹中。

接下来，你可以通过以下简单的语句来改变当前显示的背景图片和人物立绘：

```
changeBg:testBG03.jpg;//改变背景
changeFigure:testFigure02.png;//改变人物立绘
changeBg:none;//关闭背景
changeFigure:none;//关闭人物立绘
```

你有可能会发现，在你改变背景图片或人物立绘后，你需要再点击一下鼠标才能显示下一条对话，如果你希望在改变背景图片/立绘后立即执行下一条语句的内容，请使用：

```
changeBg:testBG03.jpg -next;
changeFigure:testFigure02.png -next;//改变人物立绘
一色:谢谢学姐！;
```

如果你这样做，那么在背景图片/立绘替换后，程序会立刻执行下一条语句。

## 将立绘放在不同的位置

现在，你可以在页面的三个不同位置放置不同的立绘，只需要在放置立绘的语句处加上你要放置的位置就可以了，示例如下：

```
changeFigure:testFigure03.png -left;
changeFigure:testFigure04.png;
changeFigure:testFigure03.png -right;
```

以上三行分别对应着左、中、右三个不同的位置。三个不同位置的立绘是相互独立的，所以如果你需要清除立绘，必须分别独立清除：

```
changeFigure:none -left;
changeFigure:none;
changeFigure:none -right;
```

如果你想要在立绘改变后立刻执行下一条语句，操作方法与之前一样，即加上参数 `-next` :

```
changeFigure:testFigure03.png -left -next;
changeFigure:testFigure04.png -next;
changeFigure:testFigure03.png -right -next;
```

## 带ID的自由立绘

如果你想要更精确地控制立绘，可以为立绘指定`id`和初始位置：

```
changeFigure:testFigure03.png -left -id=test1; // 一个初始位置在右侧的自由立绘
changeFigure:none -id=test1; // 通过id关闭立绘
```

注意：如果你要重设某个带ID立绘的位置，请先关闭再重新打开。

## 放置小头像

很多游戏可以在文本框的左下角放置小头像，以下是在本引擎中使用的语法：

```
miniAvatar:minipic_test.png;//在左下角显示minipic_test.png
miniAvatar:none;//关闭这个小头像
```

## 跳转场景与分支选择

在 视觉小说 中，跳转章节、场景与分支选择是不可或缺的，因此，本游戏模组也支持场景跳转与分支选择。

你可以将你的剧本拆分成多个 txt 文档，并使用一个简单的语句来切换当前运行的剧本。

::: warning 警告
在跳转场景、分支选择或调用场景后，舞台并不会被清除。这也就意味着上一个场景应用的背景音乐、立绘、背景图片等效果会被继承到下一场景。

如果你使用 WebGAL 编辑器，你应该格外注意，因为 WebGAL 编辑器在预览单独的一个场景的时候并不关心上一个场景会带来什么效果。因此，预览效果和实际游戏运行效果可能会有所差别，你应该考虑妥善处理场景跳转前的舞台清理工作。
:::

假如你现在写了两个章节的剧本，分别是 Chapter-1.txt 与 Chapter-2.txt ，在 Chapter-1.txt 运行结束后，你希望跳转到
Chapter-2.txt 对应的场景，请使用以下语句：

### 场景跳转

语句：

```
changeScene:Chapter-2.txt;
```

示例：

```
(Chapter-1.txt)
......
......
changeScene:Chapter-2.txt;
接下来执行的就是Chapter-2.txt的内容了。
......
......
(Chapter-2.txt)
```

通过执行这条命令，你将切换游戏场景，并使接下来的剧情发展按照新的场景剧本运行。新的剧本会在下一次鼠标点击后运行。

### 场景调用

如果你需要在执行完调用的场景后回到先前的场景（即父场景），你可以使用 `callScene` 来调用场景

语句：

```
callScene:Chapter-2.txt;
```

示例：

```
(Chapter-1.txt)
......
......
callScene:Chapter-2.txt;
接下来执行的就是Chapter-2.txt的内容了。
......
......
(Chapter-2.txt)
......
(Chapter-2.txt执行完毕)
回父场景，继续执行父场景语句。
......

```

### 分支选择

如果你的剧本存在分支选项，你希望通过选择不同的选项进入不同的章节，请使用以下语句：

其中，`|`是分隔符。

```
choose:叫住她:Chapter-2.txt|回家:Chapter-3.txt;
```

你只需要将选项的文本与选择选项后要进入的剧本名称一一对应起来，就可以实现分支选择的功能了。

## 结束游戏并返回到标题

如果你想要在剧情结束后结束游戏并返回到标题，请使用：

```
end;
```

这样，就可以使游戏返回标题界面。

## 引入背景音乐（BGM）

引入背景音乐的方法极其简单，你只需要将背景音乐放置在 /bgm 目录下，然后便可以简单地在需要的时候令其播放：

```
bgm:夏影.mp3;
```

可以为背景音乐设置一个 `-volume` 参数，来调整它的音量。

```
bgm:夏影.mp3 -volume=30; // 当 volume 为数值，且值在 0 ~ 100 范围时可用
```

此外，还可以使用 `-enter` 参数，进行淡入播放。

```
bgm:夏影.mp3 -enter=3000; // 当 enter 为数值，且值大于等于 0 时可用
```

最后，可以使用以下语句，进行背景音乐的淡出。

```
bgm:none -enter=3000; // 当 enter 为数值，且值大于等于 0 时可用
```

::: tip 提示
`-volume` 和 `-enter` 都是可选参数。
`-volume` 未使用时，或使用了不可用的值时，将使用默认值 100。
`-enter`  未使用时，或使用了不可用的值时，将使用默认值 0。
:::

## 使用效果音

```
playEffect:xxx.mp3;
```

可以播放一小段效果音

### 效果音循环

为效果音赋予一个 id 将会自动启用效果音循环，后续使用相同的 id 来停止

```
playEffect:xxx.mp3 -id=xxx;
playEffect:none -id=xxx;停止这个循环的效果音
```

## 播放一小段视频

```
playVideo:OP.mp4//视频应该放在/game/video/ 文件夹内
```

## 解锁BGM或CG以供鉴赏

在 WebGAL 4.2 中，加入了BGM和CG的鉴赏功能，你可以执行以下语句在适当的时机解锁BGM或CG。

```
unlockCg:xgmain.jpeg -name=星光咖啡馆与死神之蝶 -series=1; // 解锁CG并赋予名称
unlockBgm:s_Title.mp3 -name=Smiling-Swinging!!; // 解锁bgm并赋予名称
```

其中，`series`参数可选，代表当前立绘属于哪个系列。同系列的立绘以后会合并展示（即展示成可以切换的同系列CG）。

## 关闭文本框

有时候，为了一些特殊的演出效果，可能你希望临时关闭文本框，所以你可以使用以下指令：

```
setTextbox:hide;
```

来关闭文本框。当 `setTextbox` 指令的值为 `hide` 时，会关闭文本框，且用户无法以任何方式打开。如果想要重新显示文本框，请再次调用此命令，并输入除`hide`以外的任意值。

```
setTextbox:on; // 可以是除 hide 以外的任意值。
```

## 使用动画效果

### 为背景或立绘设置动画

使用语句 `setAnimation:动画名 -target=作用目标;`

**示例：**

```
setAnimation:enter-from-bottom -target=fig-center -next;//为中间立绘设置一个从下方进入的动画，并转到下一句。
```

目前，预制的动画有：

| 动画效果 | 动画名    | 持续时间（毫秒） |
| -------- | --------- | --------- |
| 渐入     | enter | 300 |
| 渐出 | exit | 300 |
| 左右摇晃一次     | shake    | 1000 |
| 从下侧进入 | enter-from-bottom | 500 |
| 从左侧进入 | enter-from-right | 500 |
| 从右侧进入 | enter-from-right | 500 |
| 前后移动一次   | move-front-and-back | 1000 |

目前，动画的作用目标有：

| target     | 实际目标       |
| ---------- | -------------- |
| fig-left   | 左立绘         |
| fig-center | 中间立绘       |
| fig-right  | 右侧立绘       |
| bg-main    | 背景           |
|            | 某个有id的立绘 |

### 自定义动画

动画文件在`/game/animation`，你可以创建自己的自定义动画。

动画文件使用 JSON 描述，你可以在 [参考文档](https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON) 参考JSON语法。

每一个动画文件都代表一个**动画序列**，使用一个JSON数组来描述。下面是一个示例，描述了一个从左侧进入的动画：

`enter-from-left.json`

```json
[
  {
    "alpha": 0,
    "scale": {
      "x": 1,
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": -50,
      "y": 0
    },
    "rotation": 0,
    "blur": 5,
    "duration": 0
  },
  {
    "alpha": 1,
    "scale": {
      "x": 1,
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": 0,
      "y": 0
    },
    "rotation": 0,
    "blur": 0,
    "duration": 500
  }
]

```

其中各个属性代表的释义为：

| 属性名   | 释义                                 |
| -------- | ------------------------------------ |
| alpha    | 透明度，范围0-1                      |
| scale    | 缩放                                 |
| pivot    | 锚点                                 |
| position | 位置偏移                                 |
| rotation | 旋转角度，单位为弧度                 |
| blur     | 高斯模糊半径                         |
| duration | 这个时间片的持续时间，单位为毫秒(ms) |

然后，你需要在 `animationTable`中加上你的自定义动画的文件名（不需要后缀名）

在文件`animationTable.json`：

```json
["enter-from-left","enter-from-bottom","enter-from-right"]
```

然后，你就可以在脚本中调用：

```
setAnimation:enter-from-left -target=fig-left -next;
```

### 省略部分属性

如果你的动画只需要操作部分属性，你可以将其他不参与动画的属性留空，使它们保持默认：

**示例：`enter.json`**

```json
[
  {
    "alpha": 0,
    "duration": 0
  },
  {
    "alpha": 1,
    "duration": 300
  }
]

```

### 使用变换

一个持续时间为0毫秒，且只有一个时间片的动画就是变换。

**示例：**

```
[
  {
    "alpha": 0,
    "duration": 0
  }
]
```

## 添加特效

目前，WebGAL 的特效系统由 PixiJS 实现。

### 初始化 Pixi

`pixiInit`

```
pixiInit;
```

**注意：**

**1.如果你要使用特效，那么你必须先运行这个命令来初始化 Pixi。**

**2.如果你想要消除已经作用的效果，你可以使用这个语法来清空效果。**

### 添加特效

`pixiPerform`

```
pixiPerform:rain;//添加一个下雨的特效
```

注意：特效作用后，如果没有初始化，特效会一直运行。

### 预制特效列表

| 效果 | 指令              |
| ---- | ----------------- |
| 下雨 | pixiPerform:rain; |
| 下雪 | pixiPerform:snow; |

### 叠加特效

如果你想要叠加两种及以上效果，你可以在不使用`pixiInit`指令的情况下叠加不同的效果。

```
pixiPerform:rain;
pixiPerform:snow;
```

### 清除已叠加的特效

使用 `pixiInit`来初始化，这样可以消除所有已经应用的效果。

### 电影模式（测试功能）

通过执行脚本`filmMode:enable;`来开启电影模式，`filmMode:none;`可以关闭。
