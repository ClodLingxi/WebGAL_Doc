# 基本スクリプト

まず、ゲームは**最初のスクリプト**である`start.txt`から実行を開始します。シーンジャンプや選択肢の設定方法については[こちら](#シーンジャンプと選択肢)。

**スクリプトを記述方法は非常に簡単であり、自然言語とほとんど変わりません。**

## キャラクターの会話

まず、メモ帳、VS Code、Sublime などのテキストエディタを使用して、ゲームリソースディレクトリの `scene` フォルダーの中の `start.txt` を開き、最初の会話を書き始めることができます。

キャラクターの会話を書く方法は非常に簡単です。次のように入力するだけです。

**各行のコロンとセミコロンは半角文字である必要があることに注意してください！**

```
キャラクター:セリフ; 
```

例:

```
雪ノ下 雪乃: お茶、どうぞ。;
由比ヶ浜 結衣: あ、ありがとうございます。;
比企谷 小町: 雪乃さん、ありがとうございます！;
一色 いろは: 先輩、ありがとうございます！;
```

各行の後にはセミコロンを使用して終了してください。（セミコロンを書かなくても機能する場合もありますが、バグを防ぐためにセミコロンを追加することをお勧めです）。

### 連続セリフ

連続した複数行のセリフでキャラクターが変更されない場合は、キャラクター名を省略できます。 キャラクターを変更する必要がある場合は、キャラクター名を再度使用します。

```
雪ノ下雪乃: 早かったわね;
結構待ったの？;//この時点では、セリフのキャラクター名は「雪ノ下雪乃」のままです。
比企谷八幡:今着いたところ;
```

### ナレーター

キャラクターの名前なしでナレーターを作成する場合は、コロンの前に空白のままにします(コロンは省略しないでください)。

```
:これはナレーターです。
```

## セリフを表示しながらボイスを再生する

ご存知のように、ビジュアルノベルゲームの最も魅力的な部分は、優れた吹き替えです。このバージョンでは、セリフにボイスを導入することができます。ボイスファイルを `vocal` フォルダーに入れ、パラメータとしてセリフに追加します。構文の例は次のとおりです。

```
比企谷八幡:今着いたところ。 -V3.ogg;
```

連続セリフの場合は、同じ方法でボイスを導入します。

```
雪之下雪乃:早かったわね。 -V1.ogg;
結構待ったの？ -V2.ogg;
```

ボイスの `-volume` パラメータを設定して、音量を調整できます。

```
比企谷八幡:今着いたところ。 -V3.ogg -volume=30; // volume が数値で、値が 0 ~ 100 の範囲にある場合に使用できる。
```

::: tip ヒント
これは省略可能なパラメータです。
使用されていない場合、または 0 ~ 100 以外の値が使用されている場合は、デフォルト値の 100 が使用されます。
:::

## モノローグ

多くのゲームでは、テーマを紹介したり、キャラクターの心理活動を示したりするために、モノローグを使用します。`intro` コマンドを利用して、モノローグを使用することができます。

```
intro:思い出には適切な台本は必要ありません。| とにかく一度言ってしまうと、| それはすべて冗談になりました。;
```

モノローグの分割は、区切り文字 `|` で区切られており、各 | は改行を表します。実際のプレゼンテーションでは、上記のモノローグは次のようになります。

```
思い出には適切な台本は必要ありません。
とにかく一度言ってしまうと、
それはすべて冗談になりました。
```

## 背景画像と立ち絵の変更

WebGAL が背景画像と立ち絵を読み取れるようにするには、背景画像を `background` フォルダーに配置し、立ち絵を `figure` フォルダーに配置する必要があります。

次に、次の簡単なステートメントを使用して、現在表示されている背景画像と立ち絵を変更します。

```
changeBg:testBG03.jpg;//背景画像を変更する
changeFigure:testFigure02.png;//立ち絵を変更する
changeBg:none;//背景を表示しない
changeFigure:none;//立ち絵を表示しない
```

背景画像または立ち絵を変更した後、次のステートメントを実行するためにマウスをもう一度クリックする必要があります。背景画像と立ち絵を変更した直後に次のステートメントの内容を実行したい場合は、`-next` を使用してください。

```
changeBg:testBG03.jpg -next; //背景画像を変更する
changeFigure:testFigure02.png -next;//立ち絵を変更する
一色:先輩、ありがとうございます！;
```

こうしたら、ゲームは背景画像または立ち絵を変更した直後に、次のステートメントを実行します。

## 立ち絵を異なる位置に配置する

3つの異なる位置に立ち絵を配置することができます。立ち絵を配置するステートメントに、パラメータとして、位置を追加するだけです。

```
changeFigure:testFigure03.png -left;
changeFigure:testFigure04.png;
changeFigure:testFigure05.png -right;
```

上記のは、左、中央、右の3つの位置に3つの異なる立ち絵を配置しています。3つの異なる位置の立ち絵は互いに独立しているため、クリアする必要がある場合は、別々にクリアする必要があります。

```
changeFigure:none -left;
changeFigure:none;
changeFigure:none -right;
```

立ち絵を変更した直後にステートメントを実行したい場合、`-next` を使用してください。

```
changeFigure:testFigure03.png -left -next;
changeFigure:testFigure04.png -next;
changeFigure:testFigure03.png -right -next;
```

## ID 付きの立ち絵

立ち絵をより正確に制御したい場合は、立ち絵に `id` を指定することがお勧めです。

```
changeFigure:testFigure03.png -id=test1; // ID 付きの立ち絵を表示する
changeFigure:none -id=test1; // ID で立ち絵を表示しない
```

注意: ID 付きの立ち絵の位置をリセットしたい場合は、まず表示しないようにしてから再度表示してください。

## ミニアバターを配置する

多くのゲームでは、テキストボックスの左下隅にミニアバターを配置できます。このエンジンで使用される構文は次のとおりです。

```
miniAvatar:minipic_test.png;// minipic_test.png をミニアバターとして表示する
miniAvatar:none;// ミニアバターを表示しない
```

## シーンジャンプと選択肢

ビジュアルノベルゲームでは、シーンジャンプと選択肢が欠かせないです。WebGAL でも、シーンジャンプと選択肢をサポートしています。

スクリプトを複数の `txt` ファイルに分割し、簡単なステートメントを使用して現在実行中のシーンを切り替えることができます。

::: warning 警告
シーンジャンプまたはシーンコールの後、シーンはクリアされません。これは、前のシーンの BGM 、立ち絵、背景画像、およびその他のリソースが次のシーンに継承されることも意味します。

WebGAL エディターを使用する場合は、WebGAL エディターは、1つのシーンのみをプレビューするときに前のシーンの効果が表示されないため、特に注意を払う必要があります。そのため、プレビュー効果と実際のゲーム実行効果は異なる場合があります。シーンジャンプの前にシーンクリーンアップを適切に処理することを検討する必要があります。
:::

`Chapter-1.txt` と `Chapter-2.txt` の 2 つのスクリプトがある場合、`Chapter-1.txt` の実行が終了した後に `Chapter-2.txt` に対応するシーンにジャンプする場合は、次のステートメントを使用します。

### シーンジャンプ

ステートメント:

```
changeScene:Chapter-2.txt; 
```

例:

```
(Chapter-1.txt) 
......
......
changeScene:Chapter-2.txt;
次に実行するのは、Chapter-2.txt の内容です。
...... 
......
(Chapter-2.txt)
```

このコマンドを実行すると、新しいシーンに切り替えてゲームを続行します。新しいシーンは、次にマウスをクリックした後に実行されます。

### シーンコール

呼び出したシーンを実行した後、前のシーン(親シーン)に戻る必要がある場合は、`callScene` コマンドを使用してシーンを呼び出す必要があります。

ステートメント:

```
callScene:Chapter-2.txt;
```

例:

```
(Chapter-1.txt)
...... 
......
callScene:Chapter-2.txt;
次に実行するのは、Chapter-2.txt の内容です。
......
......
(Chapter-2.txt) 
......
(Chapter-2.txt の実行が完了しました)  
親シーンに戻り、親シーンの実行を続行します。
......
```

### 選択肢

スクリプトに選択肢があり、異なるオプションを選択して異なるシーンに入りたい場合は、次のステートメントを使用してください。

ここで、`|` は区切り文字です。

```
choose:彼女に声をかける:Chapter-2.txt|家に帰る:Chapter-3.txt;
```

オプションのテキストを、オプションを選択した後に入りたいスクリプトファイルと 1 対 1 で対応させるだけで、選択肢の機能を実現できます。

## ゲームを終了してタイトルに戻る

スクリプトが終了した後にゲームを終了してタイトルに戻りたい場合は、次のステートメントを使用してください。

```
end;
```

これにより、ゲームはタイトル画面に戻ります。

## BGMの使用

BGM を使用する方法は非常に簡単です。BGM ファイル を /bgm フォルダーに配置し、必要なときに再生するだけです。

```
bgm:サマーシャドウ.mp3;
```

BGM の `-volume` パラメータを設定して、音量を調整できます。

```
bgm:サマーシャドウ.mp3 -volume=30; // volume が数値で、値が 0 ~ 100 の範囲にある場合に使用できる。
```

さらに、フェードイン再生に `-enter` パラメータを使用できます。

```
bgm:サマーシャドウ.mp3 -enter=3000; // enter が数値で、値が 0 以上の場合に使用できる。
```

最後に、次のステートメントを使用して、BGM をフェードアウトできます。

```
bgm:none enter=3000; // enter が数値で、値が 0 以上の場合に使用できる。
```

::: tip ヒント
`-volume` と `-enter` はオプションのパラメータです。
`-volume` が使用されていない場合、または使用できない値が使用されている場合は、デフォルト値の 100 が使用されます。
`-enter` が使用されていない場合、または使用できない値が使用されている場合は、デフォルト値の 0 が使用されます。
:::

## 効果音の使用

```
playEffect:xxx.mp3;
```

短い効果音を再生できます。

**効果音のループ**

効果音に ID を指定すると、効果音のループが自動的に有効になります。後で同じ ID を使用して停止します。

```
playEffect:xxx.mp3 -id=xxx; // 効果音のループを有効にする
playEffect:none -id=xxx; // 効果音のループを停止する
```

## 短い動画を再生する

```
playVideo:OP.mp4; // 動画は /game/video フォルダーに配置する必要があります
```

## 鑑賞のためにBGMやCGのアンロック

バージョン4.2以降、WebGAL は BGM と CG の鑑賞機能を追加しました。次のステートメントを実行することで、BGM または CG をタイミングよくアンロックすることができます。

```text
unlockCg:xgmain.jpeg -name=喫茶ステラと死神の蝶 -series=1; // CG をアンロックする
unlockBgm:s_Title.mp3 -name=Smiling-Swinging!!; // BGM をアンロックする
```

その中で、`series` パラメータはオプションであり、CG がどのシリーズに属しているかを表します。同じシリーズの CG は、将来統合されて一緒に表示されます(つまり、同じシリーズの切り替え可能な CG として表示されます)。

## テキストボックスを閉じる

一部の特殊効果を表示するために、テキストボックスを一時的に閉じたい場合は、次のステートメントを使用してください。

```
setTextbox:hide;  
```

`setTextbox` コマンドの内容が `hide` の場合、テキストボックスは閉じられ、ユーザーはそれを開くことができなくなります。テキストボックスを再表示する場合は、このコマンドを再度使用して、`hide` 以外の内容を入力してください。

```
setTextbox:on; // hide 以外の内容を入力してください。
```

## アニメーション効果の使用

### 背景画像または立ち絵にアニメーションを設定する

Use statement `setAnimation:animation name -target=target object;`

**例:**

```
setAnimation:enter-from-bottom -target=fig-center -next; // 真ん中の立ち絵に下から入るアニメーションを設定し、次のステートメントに進む。
```

### 事前に作成されたアニメーション

| アニメーション             | ファイル                  | 継続時間 (ミリ秒) |
| :------------------------ | :----------------------- | :--------------- |
| フェードイン               | enter.json               | 300              |
| フェードアウト             | exit.json                | 300              |
| 左右に振る                 | shake.json               | 1000             |
| 下から入る                 | enter-from-bottom.json   | 500              |
| 左から入る                 | enter-from-right.json    | 500              |
| 右から入る                 | enter-from-left.json     | 500              |
| 1回前後に動かす            | move-front-and-back.json | 1000             |

現在、アニメーション化できるオブジェクトは次のとおりです。

| オブジェクト     | 実際のオブジェクト    |
| :--------- | :----------------------- |
| fig-left   | 左の立ち絵                |
| fig-center | 真ん中の立ち絵            |
| fig-right  | 右の立ち絵                |
| bg-main    | 背景                     |
|            | ID 付き立ち絵             |

### カスタムアニメーション

アニメーションファイルは `/game/animation` にあります。独自のカスタムアニメーションを作成することができます。

アニメーションファイルは JSON を使用して記述します。JSON 構文を知りたい方は [こちら](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON) 。

各アニメーションファイルは、JSON 配列を使用して記述された **アニメーションシーケンス** を表します。サンプルとして、「左から入る」のアニメーションを次に示します。

```
enter-from-left.json
```

```json
[
  {
    "alpha": 0, 
    "scale": {
      "x": 1,
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": -50,
      "y": 0
    },
    "rotation": 0,
    "blur": 5,
    "duration": 0
  },
  {
    "alpha": 1,
    "scale": {
      "x": 1,  
      "y": 1
    },
    "pivot": {
      "x": 0.5,
      "y": 0.5
    },
    "position": {
      "x": 0,
      "y": 0
    },
    "rotation": 0,
    "blur": 0,
    "duration": 500
  } 
]
```

各アトリビュートの意味は次のとおりです。

| アトリビュート | 意味                                               |
| :------------ | :------------------------------------------------- |
| alpha         | 透明度、範囲 0 ～ 1                                 |
| scale         | ズーム                                              |
| pivot         | アンカーポイント                                    |
| position      | 位置オフセット                                      |
| rotation      | 回転角度                                            |
| blur          | ガススぼかし                                        |
| duration      | 継続時間 (ミリ秒 (ms) 単位)                          |

次に、カスタムアニメーションのファイル名(拡張子なし)を `animationTable` に追加する必要があります。

ファイル `animationTable.json` で:

```json
["enter-from-left","enter-from-bottom","enter-from-right"]
```

次に、スクリプトでそれを呼び出すことができます。

```
setAnimation:enter-from-left -target=fig-left -next;
```

### 一部の属性を省略する

アニメーションで一部のアトリビュートのみを操作する必要がある場合は、ほかのアトリビュートを空のままにして、デフォルトのままにすることができます。

**例:`enter.json`**

```json
[
  {
    "alpha": 0,
    "duration": 0
  },
  {
    "alpha": 1,
    "duration": 300
  }
]
```

### 変換の使用

継続時間が 0 ミリ秒で、タイムスライスが 1 つだけのアニメーションは変換です。

**例:**

```json
[
  {
    "alpha": 0, 
    "duration": 0
  }
]
```

## 特殊効果の追加

現在、WebGAL の特殊効果システムは PixiJS によって実装されています。

### Pixiの初期化

`pixiInit`

```
pixiInit; 
```

**注意:**

**1. 特殊効果を追加したい場合は、まずこのコマンドを実行して Pixi を初期化する必要があります。**

**2. 追加した特殊効果をクリアしたい場合も、このコマンドを実行してください。**

### 特殊効果の追加

`pixiPerform`

```
pixiPerform:rain; // 雨の特殊効果を追加する
```

注意: 特殊効果が追加した後、初期化されていない場合は継続して実行されます。

### 事前に作成された特殊効果

| Effect | Command           |
| :----- | :---------------- |
| 雨     | pixiPerform:rain; |
| 雪     | pixiPerform:snow; |

### 重ね合わせた特殊効果

2 つ以上の特殊効果を重ね合わせたい場合は、`pixiInit` コマンドを使用せずに異なる特殊効果を重ね合わせることができます。

```
pixiPerform:rain;
pixiPerform:snow;
```

### 特殊効果のクリア

`pixiInit` を使用して初期化すると、追加したすべての特殊効果をクリアすることができます。

### ムービーモード(テスト機能)

ムービーモードのオンとオフを切り替えるには、次のスクリプトを実行します。

```
filmMode:enable; // ムービーモードをオンにする
filmMode:none; // ムービーモードをオフにする
```
